<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚ù§Ô∏è</text></svg>">
<title>Chuy·ªán Nh·ªè Ng√†y 20/10</title>
<style>
  :root{
    --bg:#fff7fb;
    --card:#ffffffdd;
    --accent:#ff7ab6;
    --muted:#8b6b7a;
    --glass: rgba(255,255,255,0.6);
    --shadow: 0 8px 30px rgba(120,80,110,0.12);
    --timeline-height:120px;
    --card-w: 720px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background: linear-gradient(180deg,#fff0f6 0%, var(--bg) 50%, #fff 100%);
    color:#4b3240;
    -webkit-font-smoothing:antialiased;
    overflow:hidden;
    position: relative; /* For background pattern */
    
    /* DECOR M·ªöI: Con tr·ªè chu·ªôt h√¨nh tr√°i tim */
    cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="%23ff7ab6" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>'), auto;
  }

  /* NEW: Background pattern */
  body::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: url('data:image/svg+xml,<svg width="10" height="10" viewBox="0 0 10 10" xmlns="http://www.w3.org/2000/svg"><circle cx="5" cy="5" r="1" fill="%23ffd1e8" fill-opacity="0.2"/></svg>');
      background-size: 10px 10px;
      opacity: 0.3;
      z-index: -1;
      pointer-events: none;
  }

  /* DECOR M·ªöI: Hi·ªáu ·ª©ng Bokeh */
  .bokeh-background {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: -2; /* N·∫±m d∆∞·ªõi m·ªçi th·ª© */
  }
  .bokeh-background .circle {
    position: absolute;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(255, 122, 182, 0.4) 0%, rgba(255, 122, 182, 0) 70%);
    animation: floatUp 20s infinite ease-in-out;
  }
  @keyframes floatUp {
    from {
      transform: translateY(100vh) scale(1);
      opacity: 0.7;
    }
    to {
      transform: translateY(-10vh) scale(1.2);
      opacity: 0;
    }
  }
  /* K·∫øt th√∫c hi·ªáu ·ª©ng Bokeh */


  .wrap{
    height:100vh;
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:18px;
    padding:20px;
  }

  header{
    width:100%;
    max-width:1200px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
  }
  .logo{
    display:flex;
    align-items:center;
    gap:12px;
  }
  .logo .mark{
    width:56px;height:56px;border-radius:12px;
    background:linear-gradient(135deg,var(--accent),#ffd1e8);
    display:flex;align-items:center;justify-content:center;
    color:white;font-weight:700;box-shadow:var(--shadow);
  }
  h1{font-size:18px;margin:0}
  .controls{display:flex;gap:8px;align-items:center}

  .timeline-wrap{
    width:100%;
    max-width:1200px;
    height:var(--timeline-height);
    display:flex;
    align-items:center;
    justify-content:center;
    position:relative;
  }
  .timeline{
    width:calc(100% - 160px);
    height:72px;
    background:linear-gradient(90deg, rgba(255,255,255,0.4), rgba(255,255,255,0.15));
    border-radius:40px;
    display:flex;
    gap:10px;
    align-items:center;
    padding:12px 18px;
    box-shadow:var(--shadow);
    overflow-x:auto;
    scrollbar-width:none;
  }
  .timeline::-webkit-scrollbar{display:none}

  .timeline .node{
    min-width:64px;
    height:48px;
    background:var(--card);
    border-radius:12px;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    gap:4px;
    padding:6px;
    box-shadow: 0 4px 12px rgba(80,40,70,0.06);
    cursor:pointer;
    transition: all 0.3s ease;
  }
  .node .n{font-weight:700;color:var(--muted);font-size:13px}
  .node.active{background:linear-gradient(180deg,var(--accent),#ffb0d1);color:white}
  .node.completed{opacity:0.7;transform:scale(0.98)}

  .stage{
    width:100%;
    max-width:1200px;
    flex:1;
    display:flex;
    align-items:center;
    justify-content:center;
    position:relative;
    padding:12px;
  }
  .stage-viewport{
    width:var(--card-w);
    height:540px;
    border-radius:18px;
    background: linear-gradient(180deg, rgba(255,255,255,0.7), rgba(255,250,255,0.45));
    box-shadow: var(--shadow);
    position:relative;
    overflow: hidden; /* Ensure background images don't overflow */
  }

  /* NEW: Scene transition effect */
  .scenes{
    position:relative;
    width:100%;
    height:100%;
  }
  .scene{
    width:100%;
    height:100%;
    padding:28px;
    position:absolute;
    top:0; left:0;
    display:flex;
    flex-direction:column;
    gap:16px;
    opacity: 0;
    visibility: hidden;
    transition: opacity 600ms ease-in-out, visibility 600ms ease-in-out;
    will-change: opacity, visibility;

    /* NEW: Scene background image */
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    /* NEW: Parallax effect for background */
    background-attachment: fixed; /* This makes the background fixed relative to the viewport */
  }
  .scene.active {
    opacity: 1;
    visibility: visible;
  }
  /* END NEW */

  .scene .bg{ /* This overlay is still useful for text readability */
    position:absolute;inset:0;
    border-radius:18px;
    pointer-events:none;
    background:
      radial-gradient(1200px 400px at 10% 20%, rgba(255,220,240,0.35), transparent 10%),
      linear-gradient(180deg, rgba(255,245,250,0.7), rgba(255,250,255,0.25));
    filter: blur(0px);
  }

  .message-box{
    margin-top:auto;
    background:var(--glass);
    border-radius:14px;
    padding:18px;
    box-shadow: 0 6px 24px rgba(100,50,80,0.06);
    backdrop-filter: blur(6px);
    border:1px solid rgba(255,255,255,0.6);
  }
  .speaker{font-weight:700;color:#6b3750;margin-bottom:6px}
  .text{font-size:18px;line-height:1.45;min-height:68px;white-space:pre-wrap}
  .meta{display:flex;align-items:center;justify-content:space-between;margin-top:8px;color:var(--muted);font-size:13px}

  .actions{display:flex;gap:8px}
  button.btn{
    background:var(--accent);color:white;border:none;padding:10px 14px;border-radius:10px;font-weight:700;cursor:pointer;box-shadow:0 8px 20px rgba(255,120,180,0.14);
    transition: all 0.2s ease;
  }
  button.btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(255,120,180,0.2);
  }
  button.ghost{background:transparent;border:1px solid rgba(120,70,100,0.08);color:var(--muted);font-weight:600}
  button.small{padding:8px 10px;font-size:14px;border-radius:9px}

  .progress{
    width:100%;
    height:8px;
    background:rgba(0,0,0,0.05);
    border-radius:999px;
    margin-top:6px;
    overflow:hidden;
  }
  .progress > i{display:block;height:100%;background:linear-gradient(90deg,var(--accent),#ffb0d1);width:0%; transition: width 0.5s ease;}

  .petal{
    position:fixed;
    top:-60px;
    width:14px;height:14px;
    pointer-events:none;
    transform-origin:center;
    opacity:0.95;
    z-index:10;
    filter: drop-shadow(0 6px 10px rgba(200,100,150,0.09));
  }
  .petal svg{display:block}
  
  /* NEW: Page load animations */
  @keyframes fadeInUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }
  header, .timeline-wrap, .stage, footer {
      animation: fadeInUp 0.8s ease-out both;
  }
  header { animation-delay: 0.1s; }
  .timeline-wrap { animation-delay: 0.2s; }
  .stage { animation-delay: 0.3s; }
  footer { animation-delay: 0.4s; }
  
  /* NEW: Enhanced text animation */
  .text .char {
      display: inline-block;
      opacity: 0;
      transform: translateY(10px);
      animation: charFadeIn 0.5s ease-out forwards;
  }
  @keyframes charFadeIn {
      to {
          opacity: 1;
          transform: translateY(0);
      }
  }

  @media (max-width:840px){
    :root{--card-w:92vw}
    .timeline{width:calc(100% - 120px)}
  }

  footer{
    width:100%;
    max-width:1200px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:12px;
    color:var(--muted);font-size:13px;
  }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="logo">
      <div class="mark">20</div>
      <div>
        <h1>Chuy·ªán Nh·ªè Ng√†y 20/10</h1>
        <div style="font-size:13px;color:var(--muted)">D√†nh t·∫∑ng: nh·ªØng c√¥ g√°i xinh ƒë·∫πp ‚Äî m·ªôt c√¢u chuy·ªán nh·∫π, d·ªÖ th∆∞∆°ng.</div>
      </div>
    </div>

    <div class="controls">
      <button id="playMusic" class="btn small">Play nh·∫°c</button>
      <button id="downloadBtn" class="ghost small">T·∫£i trang (.html)</button>
    </div>
  </header>

  <div class="timeline-wrap">
    <div class="timeline" id="timeline"></div>
  </div>

  <main class="stage">
    <div class="stage-viewport">
      <div class="scenes" id="scenes"></div>
    </div>
  </main>

  <footer>
    <div id="count">1 / 16</div>
    <div style="flex:1;max-width:720px;margin-left:12px">
      <div class="progress" aria-hidden="true"><i id="bar"></i></div>
    </div>
  </footer>

  <div style="max-width:1200px;margin-top:6px;text-align:center;font-size:12px;color:var(--muted)">
    üéµ Nh·∫°c n·ªÅn: ‚ÄúSunny‚Äù ‚Äî KODOMOi.
  </div>

</div>

<div class="bokeh-background"></div>

<template id="petal-template">
  <div class="petal">
    <svg viewBox="0 0 24 24" width="24" height="24" >
      <path d="M12 2C14 6 20 7 20 11c0 4-6 10-8 11s-8-7-8-11c0-4 6-5 8-11z" fill="#ffd1e8" />
    </svg>
  </div>
</template>

<script>
const scenes = [
  { speaker: "Ng∆∞·ªùi k·ªÉ", text: "H√¥m nay n·∫Øng nh·∫π ‚Äî tr·ªùi nh∆∞ kho√°c chi·∫øc √°o pastel, v√† m√¨nh nghƒ© ngay ƒë·∫øn nh·ªØng ng∆∞·ªùi con g√°i d·ªÖ th∆∞∆°ng.", image: "scene-1.jpg" },
  { speaker: "B·∫°n", text: "G·ª≠i em ‚Äî ng∆∞·ªùi lu√¥n t∆∞∆°i c∆∞·ªùi k·ªÉ c·∫£ khi b·∫≠n r·ªôn.", image: "scene-2.jpg" },
  { speaker: "Ng∆∞·ªùi k·ªÉ", text: "G·ª≠i em ‚Äî ng∆∞·ªùi l√†m m·ªçi th·ª© th·∫≠t ch·ªân chu, tr·ª´ m·ªói vi·ªác ‚ÄúchƒÉm m√¨nh‚Äù l√† v·∫´n ƒëang ƒë·ªÉ ch·∫ø ƒë·ªô th·ª≠ nghi·ªám.", image: "scene-3.jpg" },
  { speaker: "", text: "M√¨nh mu·ªën t·∫∑ng em m·ªôt ng√†y nh·ªè ƒë·∫ßy b·∫•t ng·ªù: m·ªôt l·ªùi khen, m·ªôt c√°i √¥m, m·ªôt m√≥n qu√† b√© xinh.", image: "scene-4.jpg" },
  { speaker: "B·∫°n", text: "Em x·ª©ng ƒë√°ng ƒë∆∞·ª£c y√™u th∆∞∆°ng b·∫±ng c·∫£ nh·ªØng ƒëi·ªÅu gi·∫£n d·ªã nh·∫•t.", image: "scene-5.jpg" },
  { speaker: "Ng∆∞·ªùi k·ªÉ", text: "N·∫øu h√¥m nay em nh·∫≠n ƒë∆∞·ª£c hoa, xin nh·ªõ r·∫±ng ƒë√≥ l√† l·ªùi c·∫£m ∆°n cho n·ª• c∆∞·ªùi em trao.", image: "scene-6.jpg" },
  { speaker: "", text: "C√≥ th·ªÉ kh√¥ng ph·∫£i hoa to, nh∆∞ng l√† hoa t·ª´ t·∫•m l√≤ng ‚Äî v√† hoa ·∫•y s·∫Ω ng√°t.", image: "scene-7.jpg" },
  { speaker: "B·∫°n", text: "Mong em lu√¥n r·∫°ng r·ª°, t·ª± tin v√† kh√¥ng ng·∫°i m∆° m·ªông.", image: "scene-8.jpg" },
  { speaker: "Ng∆∞·ªùi k·ªÉ", text: "Nh·ªØng ƒëi·ªÅu nh·ªè b√© ‚Äî m·ªôt tin nh·∫Øn ƒë√∫ng l√∫c, m·ªôt t√°ch tr√† ·∫•m ‚Äî c√≥ th·ªÉ l√†m ng√†y em b·ªõt n·∫∑ng n·ªÅ.", image: "scene-9.jpg" },
  { speaker: "", text: "H√£y d√†nh cho b·∫£n th√¢n m·ªôt ch√∫t d·ªãu d√†ng, em nh√©.", image: "scene-10.jpg" },
  { speaker: "B·∫°n", text: "C·∫£m ∆°n em v√¨ ƒë√£ t·ªìn t·∫°i, v√¨ ƒë√£ l√†m b·∫ßu tr·ªùi g·∫ßn h∆°n m·ªôt ch√∫t v·ªõi n·ª• c∆∞·ªùi.", image: "scene-11.jpg" },
  { speaker: "Ng∆∞·ªùi k·ªÉ", text: "Ch√∫c em lu√¥n hi·ªÅn l√†nh, c√° t√≠nh, v√† c√≥ nhi·ªÅu ng√†y ƒë·∫πp nh∆∞ h√¥m nay.", image: "scene-12.jpg" },
  { speaker: "", text: "G·ª≠i em ‚Äî ng∆∞·ªùi con g√°i xinh ƒë·∫πp: gi·ªØ n·ª• c∆∞·ªùi, gi·ªØ ·∫•m √°p, v√† ƒë·ª´ng qu√™n b·∫£n th√¢n.", image: "scene-13.jpg" },
  { speaker: "B·∫°n", text: "Ch√∫c m·ª´ng 20/10! Hy v·ªçng em c√≥ m·ªôt ng√†y ƒë·∫ßy ni·ªÅm vui v√† b√°nh ng·ªçt.", image: "scene-14.jpg" },
  { speaker: "Ng∆∞·ªùi k·ªÉ", text: "H·∫πn g·∫∑p l·∫°i trong nh·ªØng kho·∫£nh kh·∫Øc b√© nh·ªè kh√°c ‚Äî n∆°i em lu√¥n ƒë∆∞·ª£c y√™u th∆∞∆°ng.", image: "scene-15.jpg" },
  { speaker: "", text: "üíê T·∫∑ng em: m·ªôt l·ªùi ch√∫c ch√¢n th√†nh t·ª´ tr√°i tim.", image: "scene-16.jpg" }
];

const timelineEl = document.getElementById('timeline');
const scenesEl = document.getElementById('scenes');
const countEl = document.getElementById('count');
const barEl = document.getElementById('bar');

let idx = 0;
const total = scenes.length;

scenes.forEach((s, i) => {
  const node = document.createElement('div');
  node.className = 'node' + (i===0?' active':'');
  node.dataset.index = i;
  node.innerHTML = `<div class="n">#${i+1}</div><div style="font-size:12px">${s.speaker || '...'}</div>`;
  node.addEventListener('click', ()=> goTo(i));
  timelineEl.appendChild(node);

  const sc = document.createElement('div');
  sc.className = 'scene' + (i===0?' active':'');
  if (s.image) {
      sc.style.backgroundImage = `url(${s.image})`;
  } else {
      // Fallback for scenes without specific images
      sc.style.backgroundImage = `url('placeholder-bg.jpg')`; // A default image
  }
  sc.innerHTML = `
    <div class="bg"></div>
    <div style="display:flex;gap:12px;align-items:center">
      <div style="width:84px;height:84px;border-radius:16px;background:linear-gradient(180deg,#fff,#ffe6f2);display:flex;align-items:center;justify-content:center;font-weight:700;color:#8b415f">‚ô°</div>
      <div>
        <div style="font-size:13px;color:var(--muted)">Scene ${i+1}</div>
        <div style="font-weight:800;font-size:20px;margin-top:6px">${s.speaker || ''}</div>
      </div>
    </div>
    <div class="message-box">
      <div class="speaker">${s.speaker || ''}</div>
      <div class="text" id="text-${i}"></div>
      <div class="meta">
        <div class="actions">
          <button class="btn small" data-next>Ti·∫øp</button>
          <button class="ghost small" data-skip>B·ªè t·ªëc ƒë·ªô</button>
        </div>
        <div style="text-align:right;color:var(--muted);font-size:13px">20/10 ¬∑ Chuy·ªán nh·ªè d·ªÖ th∆∞∆°ng</div>
      </div>
    </div>
  `;
  scenesEl.appendChild(sc);
});

document.querySelectorAll('[data-next]').forEach(btn => btn.addEventListener('click', next));
document.querySelectorAll('[data-skip]').forEach(btn => btn.addEventListener('click', () => showFullText(idx))); // Added event listener

document.addEventListener('keydown', (e)=>{
  if (e.key === 'ArrowRight') next();
  if (e.key === 'ArrowLeft') prev();
});

function updateUI(){
  const nodes = timelineEl.querySelectorAll('.node');
  nodes.forEach((n, i) => {
    n.classList.toggle('active', i === idx);
    n.classList.toggle('completed', i < idx);
  });
  
  const allScenes = scenesEl.querySelectorAll('.scene');
  allScenes.forEach((sc, i) => {
    sc.classList.toggle('active', i === idx);
  });

  countEl.textContent = `${idx + 1} / ${total}`;
  const pct = Math.round((idx / (total - 1)) * 100);
  barEl.style.width = pct + '%';
  typeScene(idx);
  const activeNode = timelineEl.querySelector('.node.active');
  if (activeNode) activeNode.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });
}

function next(){
  if (idx < total - 1) { idx++; updateUI(); } else { celebration(); }
}
function prev(){
  if (idx > 0) { idx--; updateUI(); }
}
function goTo(i){
  if (i >= 0 && i < total) { idx = i; updateUI(); }
}

let typingTimer = null;
function typeScene(i) {
  clearTyping();
  const el = document.getElementById(`text-${i}`);
  if (!el) return;
  const str = scenes[i].text || '';
  el.innerHTML = '';
  let charIndex = 0;
  
  typingTimer = setInterval(() => {
    if (charIndex < str.length) {
      const charSpan = document.createElement('span');
      charSpan.className = 'char';
      charSpan.textContent = str[charIndex];
      charSpan.style.animationDelay = `${charIndex * 0.02}s`;
      el.appendChild(charSpan);
      charIndex++;
    } else {
      clearTyping();
    }
  }, 28);
}

function clearTyping(){
  if (typingTimer) { clearInterval(typingTimer); typingTimer = null; }
}

function showFullText(i) {
  clearTyping();
  const el = document.getElementById(`text-${i}`);
  if (el) {
    el.innerHTML = scenes[i].text.split('').map(char => `<span class="char" style="opacity:1; transform:none;">${char}</span>`).join('');
  }
}

function celebration(){
  for (let a = 0; a < 40; a++) spawnPetal(true);
  setTimeout(() => alert('C·∫£m ∆°n ƒë√£ xem! Ch√∫c m·ª´ng 20/10 üå∏'), 600);
}

updateUI();

const petalTemplate = document.getElementById('petal-template').content;
function spawnPetal(big = false){
  const node = petalTemplate.cloneNode(true).children[0];
  document.body.appendChild(node);
  const startX = Math.random() * window.innerWidth;
  node.style.left = startX + 'px';
  node.style.top = (-10 - Math.random() * 80) + 'px';
  const dur = 6000 + Math.random() * 6000;
  const rotate = (Math.random() * 360) | 0;
  node.animate([
    { transform: `translateY(0) rotate(${rotate}deg)`, opacity: 0.95 },
    { transform: `translateY(${window.innerHeight + 120}px) rotate(${rotate + 360}deg)`, opacity: 0.9 }
  ], { duration: dur, easing: 'linear' });
  node.animate([
    { transform: `translateX(0)` },
    { transform: `translateX(${(Math.random() - 0.5) * 300}px)` }
  ], { duration: dur, direction: 'alternate', iterations: Infinity, easing: 'ease-in-out' });
  setTimeout(() => { node.remove(); }, dur + 50);
}
setInterval(() => spawnPetal(), 800);

let audio = new Audio('./sunny.mp3');
audio.loop = true;
audio.volume = 0; // Start with 0 volume
const playBtn = document.getElementById('playMusic');
let audioFadeInterval = null;

function fadeAudio(targetVolume, duration = 1000) {
    if (audioFadeInterval) clearInterval(audioFadeInterval);
    
    const startVolume = audio.volume;
    const steps = duration / 50; // Update every 50ms
    const step = (targetVolume - startVolume) / steps;
    
    audioFadeInterval = setInterval(() => {
        const newVolume = audio.volume + step;
        if ((step > 0 && newVolume >= targetVolume) || (step < 0 && newVolume <= targetVolume)) {
            audio.volume = targetVolume;
            if (targetVolume === 0) audio.pause();
            clearInterval(audioFadeInterval);
        } else {
            audio.volume = newVolume;
        }
    }, 50);
}

playBtn.addEventListener('click', async () => {
    try {
        if (audio.paused || audio.volume === 0) { // Check both paused state and actual volume
            audio.volume = 0; // Ensure volume is 0 before starting to fade in
            await audio.play();
            fadeAudio(0.5); // Fade in to 50% volume
            playBtn.textContent = 'Pause nh·∫°c';
        } else {
            fadeAudio(0); // Fade out
            playBtn.textContent = 'Play nh·∫°c';
        }
    } catch (err) {
        console.warn("Audio play failed, starting fallback synth.", err);
        if (!audio.paused) { // Only start ambient if main audio failed to play
            startAmbient(); 
            playBtn.textContent = 'Pause nh·∫°c (thay th·∫ø)'; // Update button text for fallback
        } else {
             stopAmbient();
             playBtn.textContent = 'Play nh·∫°c';
        }
    }
});

let audioCtx, osc, gainNode;
function startAmbient(){
  if(audioCtx) return; // Prevent multiple instances
  audioCtx = new (window.AudioContext||window.webkitAudioContext)();
  osc = audioCtx.createOscillator();
  gainNode = audioCtx.createGain();
  osc.type = 'sine';
  osc.frequency.value = 220;
  gainNode.gain.setValueAtTime(0, audioCtx.currentTime); // Start at 0 volume
  gainNode.gain.linearRampToValueAtTime(0.015, audioCtx.currentTime + 1); // Fade in over 1 second
  osc.connect(gainNode);
  gainNode.connect(audioCtx.destination);
  osc.start();
}
function stopAmbient(){
  if(gainNode) {
      gainNode.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 1); // Fade out over 1 second
      setTimeout(() => {
          if (osc) { osc.stop(); osc.disconnect(); osc=null; }
          if (gainNode) { gainNode.disconnect(); gainNode=null; }
          if (audioCtx) { audioCtx.close(); audioCtx=null; }
      }, 1000);
  }
}

document.getElementById('downloadBtn').addEventListener('click', ()=>{
  const content = '<!doctype html>\n' + document.documentElement.outerHTML;
  const blob = new Blob([content], {type:'text/html;charset=utf-8'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'chuyen-nho-20-10.html';
  document.body.appendChild(a);
  a.click();
  a.remove();
});

// DECOR M·ªöI: Th√™m code JavaScript cho hi·ªáu ·ª©ng Bokeh
function createBokeh() {
  const bokehContainer = document.querySelector('.bokeh-background');
  if (!bokehContainer) return;
  const circle = document.createElement('div');
  circle.classList.add('circle');

  const size = Math.random() * 150 + 50; // K√≠ch th∆∞·ªõc t·ª´ 50px ƒë·∫øn 200px
  circle.style.width = `${size}px`;
  circle.style.height = `${size}px`;
  circle.style.left = `${Math.random() * 100}%`;
  
  // Th·ªùi gian animation v√† ƒë·ªô tr·ªÖ ng·∫´u nhi√™n
  const duration = Math.random() * 10 + 15; // t·ª´ 15s ƒë·∫øn 25s
  const delay = Math.random() * 10;
  circle.style.animationDuration = `${duration}s`;
  circle.style.animationDelay = `${delay}s`;

  bokehContainer.appendChild(circle);

  // X√≥a ƒë·ªëm s√°ng sau khi ho√†n th√†nh animation ƒë·ªÉ ti·∫øt ki·ªám t√†i nguy√™n
  setTimeout(() => {
    circle.remove();
  }, (duration + delay) * 1000);
}

// T·∫°o m·ªôt ƒë·ªëm s√°ng m·ªói gi√¢y
setInterval(createBokeh, 1000);

</script>
</body>
</html>
